# 场地系统使用说明

## 概述

场地系统已经重构，现在支持：
- 鸡在场地内活动
- 更换场地美术素材
- 设置鸡活动范围
- 基于鸡数量的自动升级
- 永久保存场地升级状态
- 两种升级类型：场地扩大 或 分形缩放

## 系统架构

### 1. AreaData (ScriptableObject)
场地数据资源，定义每个场地的配置。

### 2. AreaUpgradeManager (MonoBehaviour)
场地升级管理器，负责：
- 检测鸡数量是否溢出
- 自动升级场地
- 保存和加载场地等级
- 应用场地配置

### 3. PlayArea (MonoBehaviour)
场地组件，负责：
- 定义场地边界
- 显示场地背景
- 提供边界检测方法

## 设置步骤

### 步骤 1: 创建场地数据资源

1. 在 Project 窗口中右键点击
2. 选择 `Create > ProjectChicken > Area Data`
3. 重命名为有意义的名称（例如：`Area_Coop`, `Area_Farm`）

### 步骤 2: 配置场地数据

对于每个场地数据资源，在 Inspector 中配置：

#### 基本信息
- **Area Name**: 场地名称（例如："鸡舍", "农场"）

#### 场地配置
- **Area Size**: 场地大小（世界单位），例如 (10, 10)
- **Area Center**: 场地中心位置（世界坐标），通常为 (0, 0)

#### 美术素材
- **Background Sprite**: 场地背景 Sprite

#### 升级配置
- **Upgrade Type**: 
  - `Expand`: 场地尺寸扩大（下一个场地会更大）
  - `FractalZoom`: 摄像机拉远，穿过云层，更换场地
- **Chicken Count Threshold**: 触发升级所需的鸡数量阈值

#### 摄像机约束（仅 FractalZoom 类型需要）
- **Min Cam Size**: 摄像机最小尺寸
- **Max Cam Size**: 摄像机最大尺寸
- **Movement Bounds**: 摄像机平移限制

### 步骤 3: 创建 AreaUpgradeManager

1. 在场景中创建空 GameObject，命名为 `AreaUpgradeManager`
2. 添加 `AreaUpgradeManager` 组件
3. 在 Inspector 中配置：
   - **Area Data List**: 添加所有场地数据（按升级顺序）
   - **Play Area**: 拖入场景中的 PlayArea GameObject（或留空自动查找）
   - **Chicken Spawner**: 拖入 ChickenSpawner（或留空自动查找）
   - **Player Controller**: 拖入 PlayerController（或留空自动查找）

### 步骤 4: 配置 PlayArea

1. 在场景中找到或创建 PlayArea GameObject
2. 确保 PlayArea 组件已添加
3. 配置初始设置（这些会在场地升级时被覆盖）

## 工作流程

### 自动升级流程

1. **检测阶段**：
   - `AreaUpgradeManager` 在 `Update()` 中持续检测鸡数量
   - 当鸡数量 >= 下一个场地的 `ChickenCountThreshold` 时触发升级

2. **升级阶段**：
   - 升级到下一个场地等级
   - 应用新场地的配置（大小、中心、背景）
   - 如果是 `FractalZoom` 类型，更新摄像机约束
   - 保存场地等级到存档

3. **应用阶段**：
   - 更新 `PlayArea` 的大小和背景
   - 鸡自动适应新的场地边界
   - 新生成的鸡会在新场地内生成

### 保存和加载

- **保存**：场地等级自动保存到 `GameSaveData`
- **加载**：游戏启动时从存档加载场地等级
- **永久性**：场地升级是永久的，跨回合保存

## 升级类型说明

### Expand（场地扩大）
- 下一个场地的尺寸更大
- 鸡的活动范围扩大
- 背景 Sprite 更换
- 摄像机约束可能更新

### FractalZoom（分形缩放）
- 摄像机拉远，穿过云层
- 完全更换场地环境
- 更新摄像机约束（最小/最大缩放、平移限制）
- 视觉效果更震撼

## 示例配置

### 场地 0: 鸡舍 (Coop)
- Area Name: "鸡舍"
- Area Size: (10, 10)
- Background Sprite: [鸡舍背景]
- Upgrade Type: Expand
- Chicken Count Threshold: 10

### 场地 1: 农场 (Farm)
- Area Name: "农场"
- Area Size: (20, 20)
- Background Sprite: [农场背景]
- Upgrade Type: FractalZoom
- Chicken Count Threshold: 25
- Min Cam Size: 5
- Max Cam Size: 15
- Movement Bounds: (10, 10)

## 注意事项

1. **场地数据顺序**：确保 `Area Data List` 中的场地按升级顺序排列
2. **鸡数量阈值**：每个场地的阈值应该递增
3. **背景 Sprite**：确保每个场地都有对应的背景 Sprite
4. **FractalZoom 类型**：需要配置摄像机约束，否则可能无法正常工作
5. **保存系统**：场地等级会自动保存，无需手动操作

## 调试

- 启用 `Show Debug Logs` 查看详细日志
- 检查控制台输出，确认场地升级是否触发
- 使用 Scene 视图的 Gizmos 查看场地边界

## 与旧系统的兼容性

- `PlayArea` 保持向后兼容
- `FractalUniverseManager` 可以继续使用（但建议迁移到新系统）
- 旧的场地配置可以逐步迁移到新的 `AreaData` 系统

