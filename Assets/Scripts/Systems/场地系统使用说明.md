# 场地系统使用说明

## 概述

`PlayArea` 系统允许你定义一个游戏场地，所有鸡只能在这个场地内移动。这比使用屏幕边界更灵活，可以创建任意大小和位置的场地。

---

## 一、创建场地

### 步骤 1：创建 PlayArea GameObject

1. 在 Unity 编辑器中，右键点击 Hierarchy 窗口
2. 选择 `Create Empty`，创建一个空 GameObject
3. 重命名为 `PlayArea`

### 步骤 2：添加 PlayArea 组件

1. 选中 `PlayArea` GameObject
2. 在 Inspector 中，点击 `Add Component`
3. 搜索并添加 `PlayArea` 脚本组件

### 步骤 3：添加场地美术素材（推荐）

有两种方式添加场地美术素材：

#### 方式 A：在 PlayArea GameObject 上添加 SpriteRenderer

1. 选中 `PlayArea` GameObject
2. 在 Inspector 中，点击 `Add Component`
3. 添加 `Sprite Renderer` 组件
4. 将你的场地图片拖拽到 `Sprite` 字段
5. 在 `PlayArea` 组件中：
   - 将 `PlayArea` GameObject 拖拽到 `Area Sprite Renderer` 字段（或留空，会自动查找）
   - 将场地图片拖拽到 `Area Sprite` 字段（可选）
   - ✅ 勾选 `Auto Size From Sprite`（根据 Sprite 自动设置场地大小）

#### 方式 B：创建子对象显示场地

1. 右键点击 `PlayArea` GameObject，选择 `2D Object > Sprite`
2. 重命名为 `AreaVisual`
3. 将你的场地图片拖拽到 `Sprite Renderer` 的 `Sprite` 字段
4. 在 `PlayArea` 组件中：
   - 将 `AreaVisual` GameObject 拖拽到 `Area Sprite Renderer` 字段
   - ✅ 勾选 `Auto Size From Sprite`

### 步骤 4：配置场地参数

在 Inspector 的 `PlayArea` 组件中：

#### 美术素材配置：
- **Area Sprite Renderer** (场地 Sprite 渲染器)：
  - 拖拽包含 `SpriteRenderer` 的 GameObject（可以是自身或子对象）
  - 如果留空，会自动查找组件

- **Area Sprite** (场地 Sprite)：
  - 可选：直接指定场地 Sprite
  - 如果设置了，会自动应用到 SpriteRenderer

- **Auto Size From Sprite** (根据 Sprite 自动设置大小)：
  - ✅ 勾选：场地大小会根据 Sprite 的尺寸自动设置（推荐）
  - ❌ 取消勾选：根据 `Area Size` 手动设置，Sprite 会自动缩放匹配

- **Sorting Order** (渲染排序顺序)：
  - 默认值：-100（确保场地在最底层，不会遮挡其他对象）
  - 数值越小越靠后，数值越大越靠前
  - 如果需要调整，可以修改这个值

- **Sorting Layer Name** (排序图层名称)：
  - 默认值：`Default`
  - 如果需要将场地放在专门的图层，可以修改这个值

#### 场地边界配置：
- **Area Size** (场地大小)：
  - X：场地的宽度（世界单位）
  - Y：场地的高度（世界单位）
  - 如果 `Auto Size From Sprite` 为 true，此值会被自动设置
  - 例如：`(10, 10)` 表示 10x10 的场地

- **Area Center** (场地中心)：
  - 如果 `Use World Bounds` 为 true：这是场地的世界坐标中心
  - 如果 `Use World Bounds` 为 false：这是相对于 GameObject 位置的偏移
  - 例如：`(0, 0)` 表示场地中心在原点

- **Use World Bounds** (使用世界坐标边界)：
  - ✅ 勾选：场地中心使用世界坐标（推荐）
  - ❌ 取消勾选：场地中心相对于 GameObject 的 Transform 位置

#### 可视化配置：
- **Show Gizmos** (显示 Gizmos)：
  - ✅ 勾选：在 Scene 视图中显示场地边界（绿色线框）
  - 方便调试和查看场地范围

- **Gizmo Color** (Gizmo 颜色)：
  - 设置 Scene 视图中边界线的颜色（默认绿色）

---

## 二、配置示例

### 示例 1：使用美术素材，自动设置大小（推荐）

```
1. PlayArea GameObject 有 SpriteRenderer 组件
2. Area Sprite: 你的场地图片
3. Auto Size From Sprite: ✅ 勾选
4. Area Size: (自动根据 Sprite 设置)
5. Area Center: (0, 0)
6. Use World Bounds: ✅ 勾选
```

### 示例 2：手动设置大小，Sprite 自动缩放

```
1. PlayArea GameObject 有 SpriteRenderer 组件
2. Area Sprite: 你的场地图片
3. Auto Size From Sprite: ❌ 取消勾选
4. Area Size: (10, 10) - 手动设置
5. Area Center: (0, 0)
6. Use World Bounds: ✅ 勾选
```

Sprite 会自动缩放以匹配 `Area Size`。

### 示例 3：在 (5, 5) 位置的 8x6 场地

```
Area Size: (8, 6)
Area Center: (5, 5)
Use World Bounds: ✅ 勾选
```

### 示例 4：相对于 GameObject 位置的场地

```
Area Size: (12, 12)
Area Center: (0, 0)
Use World Bounds: ❌ 取消勾选
```

在这种情况下，场地中心会跟随 `PlayArea` GameObject 的 Transform 位置。

---

## 三、工作原理

### 鸡的移动限制

- `ChickenUnit` 会自动检测 `PlayArea.Instance`
- 如果存在场地，鸡会被限制在场地边界内
- 如果不存在场地，会回退到使用屏幕边界（向后兼容）

### 鸡的生成位置

- `ChickenSpawner` 会优先使用场地边界生成鸡
- 如果不存在场地，会使用屏幕边界生成（向后兼容）

---

## 四、可视化调试

### 在 Scene 视图中查看场地

1. 确保 `Show Gizmos` 已勾选
2. 在 Scene 视图中，你会看到绿色线框显示场地边界
3. 调整 `Area Size` 和 `Area Center` 可以实时看到边界变化

### 调整场地大小和位置

- **方法 1**：直接在 Inspector 中修改 `Area Size` 和 `Area Center`
- **方法 2**：如果 `Use World Bounds` 为 false，可以移动 `PlayArea` GameObject 来改变场地位置

---

## 五、高级用法

### 动态调整场地大小

你可以在运行时通过代码调整场地：

```csharp
// 获取场地实例
PlayArea playArea = PlayArea.Instance;

// 注意：PlayArea 的字段是 private，需要通过反射或添加公共方法
// 或者直接在 Inspector 中配置
```

### 检查位置是否在场地内

```csharp
if (PlayArea.Instance != null)
{
    bool isInArea = PlayArea.Instance.IsPositionInArea(position, padding: 0.5f);
}
```

### 将位置限制在场地内

```csharp
if (PlayArea.Instance != null)
{
    Vector2 clampedPos = PlayArea.Instance.ClampPositionToArea(position, padding: 0.5f);
}
```

---

## 六、注意事项

1. **单例模式**：场景中只能有一个 `PlayArea` 实例。如果有多个，会保留第一个。

2. **向后兼容**：如果没有 `PlayArea`，系统会回退到使用屏幕边界，不会报错。

3. **边界内边距**：
   - `ChickenUnit` 使用 `boundaryPadding`（默认 0.5）
   - `ChickenSpawner` 使用 `spawnPadding`（默认 1.0）
   - 这些内边距确保鸡不会紧贴边界

4. **坐标系统**：
   - 场地使用 2D 世界坐标
   - Z 坐标始终为 0（2D 游戏）

---

## 七、完整配置流程

### 使用美术素材的配置流程：

1. ✅ 创建 `PlayArea` GameObject
2. ✅ 添加 `PlayArea` 组件
3. ✅ 添加 `Sprite Renderer` 组件（在 PlayArea 上或创建子对象）
4. ✅ 将场地图片拖拽到 `Sprite Renderer` 的 `Sprite` 字段
5. ✅ 在 `PlayArea` 组件中：
   - 将 `Sprite Renderer` GameObject 拖拽到 `Area Sprite Renderer` 字段
   - ✅ 勾选 `Auto Size From Sprite`（推荐）
6. ✅ 设置 `Area Center`（例如：0, 0）
7. ✅ 勾选 `Use World Bounds`
8. ✅ 勾选 `Show Gizmos`（方便调试）
9. ✅ 运行游戏，场地会显示你的美术素材，鸡会被限制在场地内

### 不使用美术素材的配置流程：

1. ✅ 创建 `PlayArea` GameObject
2. ✅ 添加 `PlayArea` 组件
3. ✅ 设置 `Area Size`（例如：10x10）
4. ✅ 设置 `Area Center`（例如：0, 0）
5. ✅ 勾选 `Use World Bounds`
6. ✅ 勾选 `Show Gizmos`（方便调试）
7. ✅ 运行游戏，鸡会被限制在场地内

---

## 完成！

配置完成后：
- ✅ 所有鸡只能在场地内移动
- ✅ 鸡生成时会在场地内随机位置
- ✅ 鸡超出边界时会自动调整方向
- ✅ 可以在 Scene 视图中看到场地边界

享受你的场地系统吧！

