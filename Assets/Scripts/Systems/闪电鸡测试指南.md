# 闪电鸡测试指南

## 概述

闪电鸡是一种特殊的鸡类型，当下蛋时有概率触发链式闪电效果，对附近的鸡造成伤害。

## 功能特性

1. **闪电鸡生成**：可以通过 `ChickenSpawner` 配置生成概率
2. **下蛋触发**：闪电鸡下蛋时有概率触发链式闪电
3. **链式伤害**：闪电会在多个目标之间跳跃，造成连锁伤害
4. **视觉效果**：触发时会显示闪电链的视觉效果

## 测试步骤

### 1. 启用闪电鸡生成

在 Unity Editor 中：

1. 找到场景中的 `ChickenSpawner` 对象
2. 在 Inspector 面板中找到 **"闪电鸡生成配置"** 部分
3. 勾选 **"Enable Lightning Chicken"**（启用闪电鸡生成）
4. 设置 **"Lightning Chicken Spawn Rate"**（闪电鸡生成概率）
   - 建议测试时设置为 `1.0`（100%生成）或 `0.5`（50%生成），便于观察
   - 默认值为 `0.05`（5%生成）

### 2. 配置 ChainLightningEffect 组件

确保场景中存在 `ChainLightningEffect` 组件：

1. 在场景中创建一个空 GameObject，命名为 `ChainLightningEffect`
2. 添加 `ChainLightningEffect` 组件（位于 `ProjectChicken.Abilities` 命名空间）
3. 配置组件参数：
   - **Visual Duration**：闪电视觉效果持续时间（默认 0.2 秒）
   - **Lightning Color**：闪电颜色（默认黄色）
   - **Lightning Width**：闪电宽度（默认 0.1）
   - **Lightning Sorting Order**：排序顺序（默认 300，确保显示在鸡上方）
   - **Enemy Layer**：敌人所在的 Layer（用于检测目标）

### 3. 配置单个闪电鸡（可选，用于精确测试）

如果想测试特定的闪电鸡：

1. 在场景中找到或创建一个 `ChickenUnit` 对象
2. 在 Inspector 面板中找到 **"闪电鸡设置（可选）"** 部分
3. 勾选 **"Is Lightning Chicken"**（是否为闪电鸡）
4. 配置闪电参数：
   - **Lightning Egg Trigger Chance**：下蛋时触发闪电的概率（0-1，默认 0.5）
   - **Lightning Max Targets**：闪电链最大目标数量（默认 5）
   - **Lightning Chain Decay**：每次跳跃后的概率衰减系数（0-1，默认 0.5）
   - **Lightning Damage Percent**：每次跳跃造成的伤害比例（默认 0.5，即 50%）
   - **Lightning Range**：闪电链搜索范围（世界单位，默认 5）

### 4. 测试场景准备

1. **确保有足够的鸡**：
   - 至少生成 5-10 只鸡，以便观察闪电链效果
   - 鸡之间距离不要太远（在闪电搜索范围内）

2. **确保游戏状态**：
   - 游戏处于 `Playing` 状态
   - 有足够的鸡可以触发下蛋

### 5. 测试流程

#### 测试 1：验证闪电鸡生成

1. 启动游戏
2. 观察生成的鸡
3. 检查是否有闪电鸡（闪电鸡在 Inspector 中会显示为蓝色调，或通过代码设置的特殊外观）
4. 可以在 Console 中查看是否有相关日志（如果添加了调试日志）

#### 测试 2：验证下蛋触发闪电

1. 等待闪电鸡下蛋（或手动触发下蛋）
2. 观察是否触发闪电链效果：
   - 应该看到黄色的闪电线条连接多个鸡
   - 闪电应该从下蛋的闪电鸡开始，跳跃到附近的其他鸡
3. 检查伤害是否生效：
   - 被闪电击中的鸡应该受到伤害
   - 瘦鸡（已下蛋的鸡）应该受到伤害并可能被击杀

#### 测试 3：验证闪电链传播

1. 确保场景中有多个鸡（至少 3-5 只）
2. 让闪电鸡下蛋触发闪电
3. 观察闪电链：
   - 闪电应该从起始目标跳跃到附近的其他鸡
   - 每次跳跃的概率会衰减（根据 `Lightning Chain Decay` 配置）
   - 最多跳跃到 `Lightning Max Targets` 个目标

#### 测试 4：验证参数调整

调整以下参数，观察效果变化：

- **Lightning Egg Trigger Chance**：
  - 设置为 `1.0`：每次下蛋都触发（便于测试）
  - 设置为 `0.0`：从不触发（验证关闭功能）

- **Lightning Max Targets**：
  - 设置为 `1`：只攻击起始目标
  - 设置为 `10`：可以攻击更多目标

- **Lightning Chain Decay**：
  - 设置为 `1.0`：每次跳跃概率不衰减（更容易传播）
  - 设置为 `0.1`：每次跳跃概率大幅衰减（更难传播）

- **Lightning Damage Percent**：
  - 设置为 `1.0`：每次跳跃造成 100% 伤害
  - 设置为 `0.1`：每次跳跃造成 10% 伤害

- **Lightning Range**：
  - 设置为 `2.0`：较小的搜索范围
  - 设置为 `10.0`：较大的搜索范围

## 快速测试方法

### 方法 1：通过 Inspector 直接设置

1. 在场景中找到一只鸡（`ChickenUnit`）
2. 在 Inspector 中勾选 `Is Lightning Chicken`
3. 将 `Lightning Egg Trigger Chance` 设置为 `1.0`（100%触发）
4. 运行游戏，抚摸这只鸡让它下蛋
5. 观察是否触发闪电效果

### 方法 2：通过代码强制生成

如果需要通过代码强制生成闪电鸡，可以在 `ChickenSpawner` 的 `SpawnChicken` 方法中临时修改：

```csharp
// 在生成鸡后，强制设置为闪电鸡（仅用于测试）
newChicken.SetLightningChicken(true);
```

### 方法 3：使用 Unity Editor 脚本

创建一个 Editor 脚本，添加右键菜单选项来快速生成闪电鸡：

```csharp
#if UNITY_EDITOR
using UnityEditor;
using UnityEngine;
using ProjectChicken.Units;

public class LightningChickenTestHelper
{
    [MenuItem("GameObject/Test/Spawn Lightning Chicken")]
    static void SpawnLightningChicken()
    {
        // 在鼠标位置生成一只闪电鸡
        // 实现代码...
    }
}
#endif
```

## 常见问题排查

### 问题 1：闪电鸡没有生成

**检查项**：
- `ChickenSpawner` 的 `Enable Lightning Chicken` 是否勾选
- `Lightning Chicken Spawn Rate` 是否大于 0
- 生成概率是否足够高（可以临时设置为 1.0 测试）

### 问题 2：下蛋后没有触发闪电

**检查项**：
- `ChainLightningEffect.Instance` 是否为 null（确保场景中有该组件）
- `Is Lightning Chicken` 是否为 true
- `Lightning Egg Trigger Chance` 是否大于 0
- 检查 Console 是否有错误信息

### 问题 3：闪电效果不显示

**检查项**：
- `ChainLightningEffect` 组件的配置是否正确
- `Lightning Sorting Order` 是否足够大（确保显示在鸡上方）
- `Lightning Color` 是否可见（避免与背景色相同）
- 检查是否有其他对象遮挡

### 问题 4：闪电没有跳跃到其他鸡

**检查项**：
- 场景中是否有其他鸡在 `Lightning Range` 范围内
- `Lightning Max Targets` 是否大于 1
- `Lightning Chain Decay` 是否导致概率衰减过快
- 检查 `ChainLightningEffect` 的 `Enemy Layer` 配置是否正确

## 调试技巧

### 1. 添加调试日志

在 `ChickenUnit.cs` 的 `Product()` 方法中添加日志：

```csharp
if (isLightningChicken)
{
    Debug.Log($"闪电鸡下蛋，触发概率检查: {lightningEggTriggerChance}");
    if (UnityEngine.Random.value < lightningEggTriggerChance)
    {
        Debug.Log("触发闪电链！");
    }
}
```

### 2. 使用 Unity Profiler

- 检查闪电触发时的性能影响
- 观察 LineRenderer 的创建和销毁

### 3. 使用 Scene View

- 在 Scene 视图中观察闪电链的绘制
- 检查目标位置是否正确

## 预期行为

1. **闪电鸡生成**：根据配置的概率随机生成
2. **下蛋触发**：下蛋时有配置的概率触发闪电链
3. **闪电链效果**：
   - 从下蛋的闪电鸡开始
   - 跳跃到附近的其他鸡（在搜索范围内）
   - 每次跳跃造成伤害（根据伤害百分比）
   - 最多跳跃到配置的最大目标数量
   - 显示黄色的闪电线条视觉效果

## 测试检查清单

- [ ] 闪电鸡可以正常生成
- [ ] 闪电鸡下蛋时可以触发闪电链
- [ ] 闪电链可以正确跳跃到附近的目标
- [ ] 闪电链造成的伤害正确
- [ ] 闪电视觉效果正常显示
- [ ] 闪电链的参数调整生效
- [ ] 多个闪电鸡同时触发时不会冲突
- [ ] 性能表现正常（没有卡顿）

## 相关文件

- `Assets/Scripts/Units/ChickenUnit.cs` - 闪电鸡的主要逻辑
- `Assets/Scripts/Systems/ChickenSpawner.cs` - 闪电鸡生成配置
- `Assets/Scripts/Abilities/ChainLightningEffect.cs` - 链式闪电效果实现
