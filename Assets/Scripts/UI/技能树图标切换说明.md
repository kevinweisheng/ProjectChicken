# 技能树图标切换说明

## 概述

现在 `SkillSlotUI` 组件支持根据技能的升级状态自动切换图标：
- **未完全升级的技能**：使用普通图标（从 `SkillNodeData.Icon` 读取）
- **完全升级的技能**：使用满级图标（从 `SkillSlotUI.maxLevelIconSprite` 读取）

## 功能说明

### 修改内容

1. **添加了图标配置字段**：
   - `maxLevelIconSprite`：满级时的图标 Sprite（可选）
   - 如果设置了这个字段，当技能达到最大等级时，会自动切换到此图标

2. **智能切换逻辑**：
   - 当技能达到最大等级时，如果指定了 `maxLevelIconSprite`，会切换到此图标
   - 当技能未满级时，会恢复为普通图标（`targetSkill.Icon`）
   - 如果没有指定 `maxLevelIconSprite`，满级时只改变颜色（保持向后兼容）

## 配置步骤

### 方法一：为每个技能槽单独配置（推荐）

如果你希望不同的技能使用不同的满级图标：

1. **找到技能槽 GameObject**：
   - 在 Hierarchy 中找到技能树面板下的技能槽 GameObject
   - 或者在 Project 中找到技能槽预制体

2. **选择技能槽 GameObject**：
   - 在 Inspector 中查看 `SkillSlotUI` 组件

3. **配置满级图标**：
   - 展开 "图标配置" 部分
   - **Max Level Icon Sprite**：将你的满级图标 Sprite 拖入此字段

4. **保存预制体**（如果修改的是预制体）：
   - 点击 Inspector 顶部的 "Apply" 按钮保存更改

### 方法二：使用统一的满级图标

如果你希望所有技能使用相同的满级图标：

1. **创建或选择一个满级图标 Sprite**

2. **为每个技能槽配置**：
   - 在 Hierarchy 中选择所有技能槽 GameObject
   - 在 Inspector 中批量设置 `Max Level Icon Sprite` 字段
   - 或者使用 Unity 的批量编辑功能

3. **保存预制体**：
   - 如果修改的是预制体，点击 "Apply" 保存

## 工作流程

### 图标切换逻辑

1. **初始化时**：
   - `InitializeDisplay()` 设置普通图标（`targetSkill.Icon`）

2. **状态更新时**：
   - `UpdateUIState()` 检查技能等级状态
   - 如果达到最大等级，调用 `SetMaxLevelState()`
   - 如果未满级，调用 `SetAvailableState()` 或 `SetLockedState()`

3. **满级状态**：
   - 如果 `maxLevelIconSprite` 不为空：
     - 切换图标为 `maxLevelIconSprite`
     - 颜色设置为白色（`Color.white`），显示 Sprite 的原始颜色
   - 如果 `maxLevelIconSprite` 为空：
     - 保持当前图标不变
     - 颜色设置为绿色（`unlockedColor`），向后兼容旧行为

4. **未满级状态**：
   - 如果当前使用的是满级图标，恢复为普通图标（`targetSkill.Icon`）
   - 设置相应的颜色（正常颜色或禁用颜色）

## 示例配置

### 场景 1：为单个技能配置满级图标

```
SkillSlotUI 组件：
├─ 技能数据
│  └─ Target Skill: [技能数据]
├─ UI组件引用
│  ├─ Icon Image: [Image 组件]
│  └─ ...
├─ 图标配置
│  └─ Max Level Icon Sprite: [满级图标 Sprite]
└─ 颜色配置
   ├─ Normal Color: White
   ├─ Disabled Color: Gray
   └─ Unlocked Color: Green
```

### 场景 2：不设置满级图标（使用颜色变化）

```
SkillSlotUI 组件：
├─ 技能数据
│  └─ Target Skill: [技能数据]
├─ UI组件引用
│  ├─ Icon Image: [Image 组件]
│  └─ ...
├─ 图标配置
│  └─ Max Level Icon Sprite: (空)
└─ 颜色配置
   ├─ Normal Color: White
   ├─ Disabled Color: Gray
   └─ Unlocked Color: Green (满级时显示此颜色)
```

## 注意事项

1. **Sprite 导入设置**：
   - 确保你的满级图标 Sprite 在 Unity 中正确导入
   - 建议使用 2D Sprite 类型
   - 检查 Sprite 的 Pixels Per Unit 设置，确保大小与普通图标一致

2. **向后兼容**：
   - 如果不设置 `maxLevelIconSprite`，满级时仍然会使用颜色变化（绿色）来标识满级状态
   - 这样可以逐步迁移，不需要一次性为所有技能配置满级图标

3. **图标尺寸**：
   - 建议满级图标与普通图标使用相同的尺寸
   - 这样可以避免图标切换时的缩放问题

4. **性能考虑**：
   - 图标切换在状态更新时执行，不会影响运行时性能
   - 建议使用相同尺寸的 Sprite，避免不必要的缩放

5. **预制体应用**：
   - 如果修改了预制体实例，记得点击 "Apply" 保存到预制体
   - 这样所有使用该预制体的地方都会更新

## 测试建议

1. **测试满级图标显示**：
   - 将某个技能升级到最大等级
   - 观察图标是否切换为你设置的满级图标

2. **测试图标恢复**：
   - 如果技能未满级，观察图标是否显示为普通图标

3. **测试颜色**：
   - 如果设置了 `maxLevelIconSprite`，满级图标应该显示 Sprite 的原始颜色（不是绿色）
   - 如果没有设置 `maxLevelIconSprite`，满级图标应该显示为绿色

## 故障排除

### 问题 1：满级时没有切换图标

**可能原因**：
- `maxLevelIconSprite` 字段未设置
- Sprite 导入设置不正确

**解决方法**：
- 检查 Inspector 中 `maxLevelIconSprite` 字段是否已赋值
- 检查 Sprite 是否正确导入为 2D Sprite 类型

### 问题 2：满级图标显示为绿色而不是原始颜色

**说明**：
- 如果设置了 `maxLevelIconSprite`，满级图标会使用 Sprite 的原始颜色（白色）
- 如果你希望满级图标显示为绿色，有两种方法：
  1. 不设置 `maxLevelIconSprite`，使用颜色变化（绿色）
  2. 在美术素材中制作绿色的满级图标 Sprite

### 问题 3：图标切换后没有恢复

**可能原因**：
- `targetSkill.Icon` 为空
- 状态更新逻辑有问题

**解决方法**：
- 检查 `SkillNodeData` 的 `Icon` 字段是否已设置
- 检查技能等级是否正确更新

### 问题 4：修改后没有生效

**可能原因**：
- 修改的是预制体实例，但没有应用到预制体
- 场景中使用了不同的预制体实例

**解决方法**：
- 如果修改的是实例，点击 Inspector 顶部的 "Apply" 按钮
- 检查场景中使用的预制体是否正确

## 相关文件

- `Assets/Scripts/UI/SkillSlotUI.cs`：技能槽 UI 脚本
- `Assets/Scripts/Systems/SkillTree/SkillNodeData.cs`：技能数据脚本（包含普通图标）
- `Assets/Scripts/Core/UpgradeManager.cs`：升级管理器（判断技能等级）

## 更新日志

- **2024-XX-XX**：添加了 `maxLevelIconSprite` 字段，支持根据技能升级状态自动切换图标

